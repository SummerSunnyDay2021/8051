C51 COMPILER V9.00   I2C                                                                   05/13/2016 09:35:11 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN i2c.OBJ
COMPILER INVOKED BY: G:\Keil\C51\BIN\C51.EXE i2c.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2           * I2C ͨѶЭʵ飨2016-5-13 5 17:35 PM)
   3          
   4              I2C 鷳ĵطʱ⣬ǰǽӴ Uart ЭͲе 1602 ҺI2C ǰЭ
             -ҪЩֱʾĻͼ£
   5              
   6          SCL     ----__--__--__--__--__--__--__--__--__--__----
   7          SDA     --_S_/7 \/6 \/5 \/4 \/3 \/2 \/1 \/0 \/a \_T_--
   8          
   9              ܽһ I2C ͨѶ
  10                  1. SCL Ϊʱźţʱӵزͷͣ SCL Ϊߵƽʱȶ
  11                  2. ʼλֹͣλͼе S  Tͼ S  T λöӦΪ ͵ƽʼλ SCL  SDA 
             -Ϊ ߵƽʱ SDA һʱʾݴĿʼ֮෴ SCL  SDA Ϊ͵ƽʱ SCL һʱ  SDA 
             -ʾݽ
  12                  3. ֡ Uart ͬǣI2C ϵÿһ֡ݲ һʼλ + 8 λλ + ack λ + λ
             -I2C λҲ˵һ֡ݿ һʼλ + 8 λ + ack λ + 8 λ + ack + ... + 8 λ + ack + 
             -λ
  13                  4. SDA ΪλΪ ack λĴڣSDA ݽӿӦΪ˫ IO 
  14                  5. ack Ӧλܵ I2C ͵ݺ ack λһݣڱе AT24C02 ӦλΪ 0
             - 
  15          
  16              I2C ͨѶʱƵʣ
  17                  I2C һֵٵͨѶЭ飬Ϊͨٺ͸٣ƵʷֱΪ 100K400K3.4M24C02 ֲ˵  2.52
             -.75V ĵѹ£Ϊ 400K Ƶûбд
  18                  
  19              ҰϵĵƬΪ STC89C52RCΪ 11.0592 MHzԼƵΪ
  20                          11.0592 * 10^6/12 = 921600  1000000 = 1000 KHz
  21              ɴ˿ɼƬ I2C ҪٶȿһЩҪֶʱ1000/400 = 2.5, 1000/100 = 10, Ϊ˼
             -ѡģʽ
  22          
  23              Ƭļʱ
  24               intrins.h ļṩһ _nop_() ûתһڣѡģʽһʱ
             -ʱҪ 3  _nop()Ҫ 2  _nop_() Ϊʹ 4  _nop_() ʱ SCL
             - ʱڡ
  25          
  26              ȻʱͼҪõʱΪ˼ſлĲͼ(S  T ӦΪ ͵
             -ƽ
  27              
  28                  SCL     ----__--__--__--__--__--__--__--__--__--__----
  29                  SDA     --SS<7-><6-><5-><4-><3-><2-><1-><0-><ac>TTTT--   
  30                  --------1---2---3---4---5---6---7---8---9---A-----
  31                  õ˲ I2C źẉ̂
  32          
  33                          1. ʼλ SDA  SClʱ SDK ʱͼ 1 λ
  34                          2. λȸ SDA ֵȻ SCLʱ SCLʱ 2 λ
  35                          3. ظڶ 9 λ
  36                          4. ACK λ SDA(ڽź)ʱ SCLȡ ackʱ SCLͼ A λ
  37                          5. λ SCL SDAʱ SCLʱ SDAʱ
  38          
  39                   I2C ͨѶʱڲ ƽ˳Ҫһ SCL δ֪Ϊߵƽʱ仯 SDA ֵ
             -ܻͷû߼ǣĵʱڵƬָٶȱȽûмλñ仯Ͳ
             -ǿеģʹõ CPLD FPGA ߸ٵ CPU ߼ǵİʵʱмʱ̱仯Ͳ
  40          
  41                  ʵĿģ
  42                          ͨ I2C Э EEPROMͺΪ AT24C02)I2C һַַڶӦô ack Ӧ 0
C51 COMPILER V9.00   I2C                                                                   05/13/2016 09:35:11 PAGE 2   

             - LedͲ Led Сơ
  43                          ֲᣬAT24C02 ĵַΪ 8'b1010_(A2)(A1)(A0)(R/W)дԷ͵Ϊ 8'b1010_0
             -000 Ƿ͵Ϊ 0xA0
  44          
  45                  ʵ
  46                           Ƿ 0xA0 ʱӦһ ACK(0)ǵ LED0
  47                          ʵлҪһڵĵַ 0xB0Ӧ ACK Ϊ 1Ϩ LED1
  48                          
  49          **/
  50          
  51          #include <reg52.h>
  52          #include <intrins.h>
  53          #define delay()         { _nop_(); _nop_(); _nop_(); _nop_(); }
  54          sbit I2C_SCL = P3^7;
  55          sbit I2C_SDA = P3^6;
  56          
  57          sbit ADDR0 = P1^0;
  58          sbit ADDR1 = P1^1;
  59          sbit ADDR2 = P1^2;
  60          sbit ADDR3 = P1^3;
  61          sbit ENLED = P1^4;
  62          sbit Led0  = P0^0;
  63          sbit Led1  = P0^1;
  64          
  65          unsigned char ack = 1;
  66          
  67          void led_init(void);
  68          void i2c_start(void);
  69          void i2c_data(unsigned char sent_data);
  70          void i2c_stop(void);
  71          
  72          void main()
  73          {
  74   1          led_init();
  75   1              i2c_start();
  76   1              i2c_data(0xA0);
  77   1              if(ack==0)
  78   1              Led0 = 0;
  79   1              else
  80   1                      Led0 = 1;
  81   1              i2c_stop();
  82   1              
  83   1              i2c_start();
  84   1              i2c_data(0xB0);
  85   1              if(ack==0)
  86   1              Led1 = 0;
  87   1              else
  88   1                      Led1 = 1;
  89   1          i2c_stop();
  90   1      
  91   1          while (1);
  92   1      }
  93          
  94          void led_init(void){
  95   1              ADDR0 = 0;
  96   1              ADDR1 = 1;
  97   1              ADDR2 = 1;
  98   1              ADDR3 = 1;
  99   1              ENLED = 0;      
 100   1      }
 101          
 102          void i2c_start(void){
C51 COMPILER V9.00   I2C                                                                   05/13/2016 09:35:11 PAGE 3   

 103   1              I2C_SDA = 1;
 104   1              I2C_SCL = 1;
 105   1              delay();
 106   1              I2C_SDA = 0;
 107   1              delay();
 108   1              I2C_SCL = 0;
 109   1      }
 110          
 111          void i2c_data(unsigned char sent_data) {
 112   1              unsigned char mask;     
 113   1              for(mask = 0x80; mask != 0; mask = mask >> 1){
 114   2                      {
 115   3                      if((mask & sent_data) == 0x00)
 116   3                              I2C_SDA = 0;
 117   3                      else
 118   3                              I2C_SDA = 1;
 119   3                      }
 120   2                      delay();
 121   2                      I2C_SCL = 1;
 122   2                      delay();
 123   2                      I2C_SCL = 0;            
 124   2              }
 125   1              I2C_SDA = 1;
 126   1              delay();
 127   1              I2C_SCL = 1;
 128   1              ack = I2C_SDA;
 129   1              delay();
 130   1              I2C_SCL = 0; 
 131   1      }
 132          
 133          void i2c_stop(void){
 134   1              I2C_SCL = 0;
 135   1              I2C_SDA = 0;
 136   1              delay();
 137   1              I2C_SCL = 1;
 138   1              delay();
 139   1              I2C_SDA = 1;
 140   1              delay();
 141   1      }
 142          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    149    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
